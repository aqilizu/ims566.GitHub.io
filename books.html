<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UiTM Library — Books</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background: #F5F5F7; }

    .navbar { background: #500778 !important; }
    .navbar-brand, .nav-link { color: white !important; }
    .nav-link.active { border-bottom: 2px solid #FFC60B; }

    /* ADDED: Style fixes for the Navbar Toggler */
    .navbar-toggler { border-color: white; } 
    .navbar-toggler-icon { filter: invert(1); } 
    /* END ADDED */

    .main-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.12);
      padding: 20px;
    }

    table thead {
      background: #2A2A72;
      color: white;
    }
    table tbody tr:hover { background: #f0e7f9; }

    .sortable { cursor: pointer; }

    .input-group input { border-color: #500778; }
    .input-group .btn { border-color: #500778; color: #500778; }
    .input-group .btn:hover { background: #500778; color: white; }
  </style>
</head>

<body>

  <nav class="navbar navbar-expand-lg shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="dashboard.html">UiTM Library</a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navmenu">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link active" href="books.html">Books</a></li>
          <li class="nav-item"><a class="nav-link" href="users.html">Users</a></li>
          <li class="nav-item"><a class="nav-link" id="logoutBtn" href="#">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-4">

    <div class="d-block d-md-flex justify-content-between align-items-center mb-3">
      <h2 class="fw-bold text-dark mb-2 mb-md-0">Books</h2>

      <div style="max-width:420px; width:100%;">
        <div class="input-group">
          <input id="searchBox" class="form-control form-control-sm" placeholder="Search title, author, ID, category">
          <button id="clearSearch" class="btn btn-outline-secondary btn-sm">Clear</button>
        </div>
      </div>
    </div>

    <div class="main-card">
      <div class="table-responsive">
        <table class="table table-striped table-hover" id="booksTable">
          <thead>
            <tr>
              <th class="sortable" data-key="id">ID ▲▼</th>
              <th class="sortable" data-key="title">Title ▲▼</th>
              <th class="sortable" data-key="author">Author ▲▼</th>
              <th class="sortable" data-key="category">Category ▲▼</th>
              <th class="sortable" data-key="available">Available ▲▼</th>
              <th class="sortable" data-key="borrowed">Borrowed ▲▼</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/app.js"></script>
  <script>
    const user = requireAuth();

    // logout
    document.getElementById('logoutBtn').addEventListener('click', (e)=>{
      e.preventDefault();
      localStorage.removeItem('libraryUser');
      window.location.href='index.html';
    });

    let books = window.SAMPLE_BOOKS.slice();
    const tbody = document.querySelector('#booksTable tbody');
    const searchBox = document.getElementById('searchBox');
    const clearSearch = document.getElementById('clearSearch');

    function renderTable(list) {
      tbody.innerHTML = '';
      if (list.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" class="text-center text-muted py-3">No books found</td></tr>`;
        return;
      }

      list.forEach(b=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${b.id}</td>
          <td>${b.title}</td>
          <td>${b.author}</td>
          <td>${b.category}</td>
          <td>${b.available}</td>
          <td>${b.borrowed}</td>`;
        tbody.appendChild(tr);
      });
    }

    renderTable(books);

    searchBox.addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      const filtered = books.filter(b =>
        (b.title + ' ' + b.author + ' ' + b.id + ' ' + b.category)
          .toLowerCase().includes(q)
      );
      renderTable(filtered);
    });

    clearSearch.addEventListener('click', ()=>{
      searchBox.value = '';
      renderTable(books);
    });

    const headers = document.querySelectorAll('.sortable');
    let sortState = { key: null, dir: 1 };

    headers.forEach(h => {
      h.addEventListener('click', ()=> {
        const key = h.dataset.key;

        if (sortState.key === key) {
          sortState.dir *= -1;
        } else {
          sortState.key = key;
          sortState.dir = 1;
        }

        books.sort((a,b)=>{
          let va = a[key], vb = b[key];
          if (typeof va === 'string') va = va.toLowerCase();
          if (typeof vb === 'string') vb = vb.toLowerCase();
          if (va < vb) return -1 * sortState.dir;
          if (va > vb) return  1 * sortState.dir;
          return 0;
        });

        renderTable(books);
      });
    });
  </script>

  <footer class="py-3 mt-4 text-center" style="background:#2A2A72; color:white;">
    <p class="mb-0">&copy; UiTM Library - Project IMS566</p>
  </footer>

</body>
</html>